(function() {
  var GPS,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  GPS = (function() {
    var layer, map, rootEl, zoom;

    rootEl = null;

    map = null;

    layer = null;

    zoom = null;

    function GPS(config) {
      this.navigateToCoords = __bind(this.navigateToCoords, this);
      this.bind = __bind(this.bind, this);
      this.init = __bind(this.init, this);
      config = $.extend({
        'rootElId': '',
        'zoom': 15
      }, config);
      this.rootEl = $(config.rootElId);
      this.zoom = config.zoom;
      this.init();
      return this;
    }

    GPS.prototype.init = function() {
      if (window.L) {
        this.map = L.mapbox.map(this.rootEl.attr('id'), 'floschieldbobby.go9bj0m8');
        this.navigateToCoords(49.4106139, 2.8172449, this.zoom);
        this.layer = L.mapbox.markerLayer({
          type: 'Feature',
          geometry: {
            type: 'Point',
            coordinates: [2.8172449, 49.4106139]
          },
          properties: {
            title: 'Addresse',
            description: '32 bd des Etats-Unis',
            'marker-size': 'large',
            'marker-color': '#2c3e50'
          }
        }).addTo(this.map);
        this.bind();
      }
      return this;
    };

    GPS.prototype.bind = function() {
      var _this = this;
      $(window).on({
        'map.setview': function(e, params) {
          if (typeof params === 'object' && params.lat && params.lng) {
            params.zoom = params.zoom || _this.zoom;
            _this.navigateToCoords(params.lat, params.lng, params.zoom);
            if (_this.layer) {
              _this.map.removeLayer(_this.layer);
            }
            return _this.layer = L.mapbox.markerLayer({
              type: 'Feature',
              geometry: {
                type: 'Point',
                coordinates: [params.lng, params.lat]
              },
              properties: {
                title: 'Addresse',
                description: params.address,
                'marker-size': 'large',
                'marker-color': '#2c3e50'
              }
            }).addTo(_this.map);
          }
        }
      });
      return this;
    };

    GPS.prototype.navigateToCoords = function(lat, lng, zoom) {
      zoom = zoom || this.zoom;
      this.map.setView([lat, lng], zoom);
      return this;
    };

    return GPS;

  })();

  $(function() {
    var __gps__;
    return __gps__ = new GPS({
      'rootElId': '#gps',
      'zoom': 16
    });
  });

}).call(this);
