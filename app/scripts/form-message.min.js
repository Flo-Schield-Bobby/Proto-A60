(function() {
  var FormMessage, Message,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Message = (function() {
    var author, date, message;

    date = null;

    author = null;

    message = null;

    function Message(config) {
      this.load = __bind(this.load, this);
      this.save = __bind(this.save, this);
      config = $.extend({
        'author': '',
        'message': ''
      }, config);
      this.date = new Date();
      this.author = config.author;
      this.message = config.message;
      return this;
    }

    Message.prototype.save = function(key) {
      localStorage.setObject(key, this);
      return this;
    };

    Message.prototype.load = function(key) {
      var data;
      data = localStorage.getObject(key);
      this.date = data.date;
      this.author = data.author;
      this.message = data.message;
      return this;
    };

    return Message;

  })();

  FormMessage = (function() {
    var formEl, listEl;

    formEl = null;

    listEl = null;

    function FormMessage(config) {
      this.bind = __bind(this.bind, this);
      config = $.extend({
        'formElId': '',
        'listElId': ''
      }, config);
      this.formEl = $(config.formElId);
      this.listEl = $(config.listElId);
      this.bind();
      return this;
    }

    FormMessage.prototype.bind = function() {
      var _this = this;
      this.formEl.on({
        'submit': function(event) {
          var containerEl, data, date, dateEl, figureEl, imgEl, message, messageEl, mins, textEl, titleEl;
          event.preventDefault();
          data = {
            'message': ''
          };
          _this.formEl.find('input:checkbox').each(function() {
            return data[$(this).data('field-name')] = $(this).is(':checked');
          });
          _this.formEl.find('input:text, textarea, select').each(function() {
            return data[$(this).data('field-name')] = $(this).val();
          });
          message = new Message({
            'author': 'Vous',
            'message': data.message
          });
          date = new Date();
          message.save('message-' + date.getTime());
          containerEl = $('<div>', {
            'class': 'row'
          });
          messageEl = $('<div>', {
            'class': 'message row col-lg-6 col-lg-push-5 col-md-6 col-md-push-5 col-md-push-5 col-sm-6 col-sm-push-5'
          });
          figureEl = $('<figure>', {
            'class': 'col-lg-4 col-md-4 col-sm-4 col-xs-4'
          });
          messageEl.append(figureEl);
          imgEl = $('<img>', {
            'class': 'avatar img-rounded'
          });
          figureEl.append(imgEl);
          titleEl = $('<h4>', {
            'class': 'message-title'
          });
          titleEl.html(message.author);
          messageEl.append(titleEl);
          dateEl = $('<p>', {
            'class': 'message-date'
          });
          mins = parseInt((date.getTime() - message.date.getTime()) / 60000);
          dateEl.html('Il y a ' + mins + ' min');
          messageEl.append(dateEl);
          textEl = $('<p>', {
            'class': 'message-text'
          });
          textEl.html(message.message);
          messageEl.append(textEl);
          containerEl.append(messageEl);
          _this.listEl.append(containerEl);
          return _this;
        }
      });
      return this;
    };

    return FormMessage;

  })();

  $(function() {
    var __form_message__;
    return __form_message__ = new FormMessage({
      'formElId': '#form-message',
      'listElId': '#app-content'
    });
  });

}).call(this);
